<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0d0f;--bg2:#13131a;--bg3:#1a1a24;--bg4:#222230;
  --border:#2e2e42;--border2:#3d3d58;
  --gold:#c9a84c;--gold2:#e8c97a;--gold3:#f5e0a0;
  --text:#d4d4e8;--text2:#9090aa;--text3:#5a5870;
  --red:#cc5555;--green:#55aa77;--amber:#cc8844;
  --accent:#7b6cee;--accent2:#a99bff;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Crimson Pro',Georgia,serif;font-size:16px;
  min-height:100vh;display:flex;flex-direction:column;}
body::before{content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events:none;z-index:9999;opacity:0.4;}

/* Toolbar */
.toolbar{display:flex;gap:6px;align-items:center;padding:10px 14px;background:var(--bg2);
  border-bottom:1px solid var(--border);flex-shrink:0;flex-wrap:wrap;}
.search-box{flex:1;min-width:120px;background:var(--bg3);border:1px solid var(--border);color:var(--text);
  padding:7px 10px 7px 32px;border-radius:3px;font-family:'Crimson Pro',serif;font-size:14px;
  outline:none;transition:border-color 0.2s;position:relative;}
.search-box:focus{border-color:var(--gold);}
.search-wrap{position:relative;flex:1;min-width:120px;}
.search-wrap::before{content:'ğŸ”';position:absolute;left:9px;top:50%;transform:translateY(-50%);
  font-size:13px;pointer-events:none;opacity:0.5;}
.btn{padding:7px 12px;border:1px solid var(--border2);background:var(--bg3);color:var(--text);
  border-radius:3px;font-family:'Cinzel',serif;font-size:10px;letter-spacing:0.06em;cursor:pointer;
  transition:all 0.15s;white-space:nowrap;}
.btn:active{border-color:var(--gold);color:var(--gold);}
.btn-gold{background:linear-gradient(135deg,#8a6a20,var(--gold));border-color:var(--gold2);
  color:#1a1200;font-weight:600;}
.btn-gold:active{filter:brightness(1.1);}
.btn-danger{border-color:var(--red);color:var(--red);}

/* Filter chips */
.filter-row{display:flex;gap:4px;padding:6px 14px;overflow-x:auto;flex-shrink:0;
  background:var(--bg);border-bottom:1px solid var(--border);}
.filter-row::-webkit-scrollbar{display:none;}
.chip{padding:4px 10px;border-radius:12px;font-family:'Cinzel',serif;font-size:8px;
  letter-spacing:0.06em;cursor:pointer;transition:all 0.15s;white-space:nowrap;
  border:1px solid var(--border);color:var(--text2);background:transparent;}
.chip.active{border-color:var(--gold);color:var(--gold);background:rgba(201,168,76,0.08);}

/* Note list */
.note-list{flex:1;overflow-y:auto;padding:10px 14px 80px;}
.note-item{background:var(--bg2);border:1px solid var(--border);border-radius:5px;
  padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:all 0.15s;position:relative;}
.note-item:active{border-color:var(--gold);}
.note-item.pinned{border-left:3px solid var(--gold);}
.note-item.pinned::after{content:'ğŸ“Œ';position:absolute;top:8px;right:10px;font-size:11px;}
.note-item-title{font-family:'Cinzel',serif;font-size:12px;color:var(--text);letter-spacing:0.04em;
  margin-bottom:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:24px;}
.note-item-body{font-size:13px;color:var(--text2);line-height:1.4;max-height:38px;overflow:hidden;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.note-item-footer{display:flex;align-items:center;gap:6px;margin-top:6px;}
.note-item-date{font-family:'Cinzel',serif;font-size:8px;color:var(--text3);letter-spacing:0.05em;}
.note-item-cat{font-family:'Cinzel',serif;font-size:8px;letter-spacing:0.06em;
  padding:1px 6px;border-radius:10px;}

/* Empty state */
.empty{text-align:center;padding:40px 16px;color:var(--text3);}
.empty-icon{font-size:42px;margin-bottom:8px;display:block;opacity:0.5;}
.empty-text{font-style:italic;font-size:15px;margin-bottom:12px;}

/* â•â•â• EDITOR OVERLAY â•â•â• */
#editor{position:fixed;inset:0;background:var(--bg);z-index:200;display:none;
  flex-direction:column;}
#editor.open{display:flex;}
.editor-bar{display:flex;align-items:center;gap:8px;padding:10px 14px;
  background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.editor-bar h2{font-family:'Cinzel',serif;font-size:12px;color:var(--gold2);letter-spacing:0.1em;flex:1;}
.editor-body{flex:1;display:flex;flex-direction:column;padding:14px;overflow-y:auto;}
.editor-body .field{margin-bottom:12px;}
.editor-body label{display:block;font-family:'Cinzel',serif;font-size:9px;letter-spacing:0.1em;
  color:var(--text2);text-transform:uppercase;margin-bottom:4px;}
.editor-body input[type="text"],.editor-body textarea,.editor-body select{
  width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text);
  padding:8px 12px;border-radius:3px;font-family:'Crimson Pro',serif;font-size:15px;
  outline:none;transition:border-color 0.2s;}
.editor-body input:focus,.editor-body textarea:focus{border-color:var(--gold);}
.editor-body textarea{resize:vertical;min-height:200px;line-height:1.7;}
.editor-body select{cursor:pointer;}
.editor-body select option{background:var(--bg3);}
.editor-footer{display:flex;gap:8px;padding:12px 14px;background:var(--bg2);
  border-top:1px solid var(--border);flex-shrink:0;}
.editor-footer .btn{flex:1;}

/* Word count */
.word-count{font-family:'Cinzel',serif;font-size:9px;color:var(--text3);text-align:right;
  margin-top:4px;letter-spacing:0.05em;}

/* Category colors */
.cat-idea{color:#9955cc;border-color:rgba(153,85,204,0.4);background:rgba(153,85,204,0.1);}
.cat-reminder{color:#cc8844;border-color:rgba(204,136,68,0.4);background:rgba(204,136,68,0.1);}
.cat-reference{color:#5588cc;border-color:rgba(85,136,204,0.4);background:rgba(85,136,204,0.1);}
.cat-dream{color:#7766aa;border-color:rgba(119,102,170,0.4);background:rgba(119,102,170,0.1);}
.cat-quote{color:#55aa77;border-color:rgba(85,170,119,0.4);background:rgba(85,170,119,0.1);}
.cat-general{color:var(--text2);border-color:var(--border);background:rgba(144,144,170,0.08);}

::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
</style>
</head>
<body>

<!-- Toolbar -->
<div class="toolbar">
  <div class="search-wrap">
    <input type="text" class="search-box" id="searchInput" placeholder="Search notesâ€¦" oninput="renderList()">
  </div>
  <button class="btn btn-gold" onclick="openNew()">+ New</button>
</div>

<!-- Filter chips -->
<div class="filter-row">
  <div class="chip active" data-cat="all" onclick="setFilter('all')">All</div>
  <div class="chip" data-cat="idea" onclick="setFilter('idea')">ğŸ’¡ Idea</div>
  <div class="chip" data-cat="reminder" onclick="setFilter('reminder')">â° Reminder</div>
  <div class="chip" data-cat="reference" onclick="setFilter('reference')">ğŸ“ Reference</div>
  <div class="chip" data-cat="dream" onclick="setFilter('dream')">ğŸŒ™ Dream</div>
  <div class="chip" data-cat="quote" onclick="setFilter('quote')">ğŸ’¬ Quote</div>
</div>

<!-- Note list -->
<div class="note-list" id="noteList"></div>

<!-- Editor overlay -->
<div id="editor">
  <div class="editor-bar">
    <h2 id="editorTitle">New Note</h2>
    <button class="btn" style="font-size:9px;padding:5px 10px;" id="pinBtn" onclick="togglePin()">ğŸ“Œ Pin</button>
    <button class="btn" onclick="closeEditor()">âœ• Close</button>
  </div>
  <div class="editor-body">
    <div class="field">
      <label>Title</label>
      <input type="text" id="noteTitle" placeholder="Note titleâ€¦">
    </div>
    <div class="field">
      <label>Category</label>
      <select id="noteCat">
        <option value="">General</option>
        <option value="idea">ğŸ’¡ Idea</option>
        <option value="reminder">â° Reminder</option>
        <option value="reference">ğŸ“ Reference</option>
        <option value="dream">ğŸŒ™ Dream</option>
        <option value="quote">ğŸ’¬ Quote</option>
      </select>
    </div>
    <div class="field" style="flex:1;display:flex;flex-direction:column;">
      <label>Note</label>
      <textarea id="noteBody" placeholder="Write your thoughtsâ€¦" style="flex:1;" oninput="updateWordCount()"></textarea>
      <div class="word-count" id="wordCount">0 words</div>
    </div>
  </div>
  <div class="editor-footer">
    <button class="btn btn-danger" id="deleteBtn" onclick="deleteNote()" style="display:none;">Delete</button>
    <button class="btn" onclick="closeEditor()">Cancel</button>
    <button class="btn btn-gold" onclick="saveNote()">Save</button>
  </div>
</div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORE = 'chronicle_notes';
let notes = [];
let editingId = null;
let activeFilter = 'all';

function loadNotes() {
  try { const s = localStorage.getItem(STORE); if (s) notes = JSON.parse(s); } catch(e) { notes = []; }
}
function saveNotes() {
  localStorage.setItem(STORE, JSON.stringify(notes));
}
function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2); }
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFilter(cat) {
  activeFilter = cat;
  document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', c.dataset.cat === cat));
  renderList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CAT_LABELS = { idea:'ğŸ’¡ Idea', reminder:'â° Reminder', reference:'ğŸ“ Reference', dream:'ğŸŒ™ Dream', quote:'ğŸ’¬ Quote' };
const CAT_CLASS = { idea:'cat-idea', reminder:'cat-reminder', reference:'cat-reference', dream:'cat-dream', quote:'cat-quote' };

function renderList() {
  const el = document.getElementById('noteList');
  const query = document.getElementById('searchInput').value.toLowerCase().trim();

  let filtered = notes;
  if (activeFilter !== 'all') {
    filtered = filtered.filter(n => n.category === activeFilter);
  }
  if (query) {
    filtered = filtered.filter(n =>
      (n.title || '').toLowerCase().includes(query) ||
      (n.body || '').toLowerCase().includes(query)
    );
  }

  // Sort: pinned first, then by updated desc
  filtered.sort((a, b) => {
    if (a.pinned && !b.pinned) return -1;
    if (!a.pinned && b.pinned) return 1;
    return (b.updated || b.created || 0) - (a.updated || a.created || 0);
  });

  if (!filtered.length) {
    el.innerHTML = `<div class="empty">
      <span class="empty-icon">ğŸ“</span>
      <div class="empty-text">${query ? 'No notes match your search.' : activeFilter !== 'all' ? 'No ' + activeFilter + ' notes yet.' : 'No notes yet. Start capturing ideas!'}</div>
      ${!query ? '<button class="btn btn-gold" onclick="openNew()">+ Create First Note</button>' : ''}
    </div>`;
    return;
  }

  el.innerHTML = filtered.map(n => {
    const d = new Date(n.updated || n.created);
    const dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' Â· ' +
                    d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    const catLabel = CAT_LABELS[n.category] || '';
    const catClass = CAT_CLASS[n.category] || 'cat-general';
    return `<div class="note-item${n.pinned ? ' pinned' : ''}" onclick="openEdit('${n.id}')">
      <div class="note-item-title">${esc(n.title || 'Untitled')}</div>
      <div class="note-item-body">${esc(n.body || '')}</div>
      <div class="note-item-footer">
        <span class="note-item-date">${dateStr}</span>
        ${catLabel ? `<span class="note-item-cat ${catClass}">${catLabel}</span>` : ''}
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openNew() {
  editingId = null;
  document.getElementById('editorTitle').textContent = 'New Note';
  document.getElementById('noteTitle').value = '';
  document.getElementById('noteBody').value = '';
  document.getElementById('noteCat').value = '';
  document.getElementById('deleteBtn').style.display = 'none';
  document.getElementById('pinBtn').style.borderColor = '';
  document.getElementById('pinBtn').style.color = '';
  document.getElementById('wordCount').textContent = '0 words';
  document.getElementById('editor').classList.add('open');
  document.getElementById('noteTitle').focus();
}

function openEdit(id) {
  const note = notes.find(n => n.id === id);
  if (!note) return;
  editingId = id;
  document.getElementById('editorTitle').textContent = 'Edit Note';
  document.getElementById('noteTitle').value = note.title || '';
  document.getElementById('noteBody').value = note.body || '';
  document.getElementById('noteCat').value = note.category || '';
  document.getElementById('deleteBtn').style.display = 'block';
  updatePinBtn(note.pinned);
  updateWordCount();
  document.getElementById('editor').classList.add('open');
}

function closeEditor() {
  document.getElementById('editor').classList.remove('open');
  editingId = null;
}

function saveNote() {
  const title = document.getElementById('noteTitle').value.trim();
  const body = document.getElementById('noteBody').value.trim();
  if (!title && !body) return;

  const now = Date.now();
  if (editingId) {
    const note = notes.find(n => n.id === editingId);
    if (note) {
      note.title = title || 'Untitled';
      note.body = body;
      note.category = document.getElementById('noteCat').value;
      note.updated = now;
    }
  } else {
    notes.push({
      id: uid(),
      title: title || 'Untitled',
      body,
      category: document.getElementById('noteCat').value,
      pinned: false,
      created: now,
      updated: now
    });
  }
  saveNotes();
  closeEditor();
  renderList();
  sendToast('Note saved âœ¦');
}

function deleteNote() {
  if (!editingId) return;
  if (!confirm('Delete this note?')) return;
  notes = notes.filter(n => n.id !== editingId);
  saveNotes();
  closeEditor();
  renderList();
  sendToast('Note deleted');
}

function togglePin() {
  if (editingId) {
    const note = notes.find(n => n.id === editingId);
    if (note) {
      note.pinned = !note.pinned;
      updatePinBtn(note.pinned);
      saveNotes();
    }
  } else {
    // New note - we'll set pin on save. Toggle visual only.
    const btn = document.getElementById('pinBtn');
    const isPinned = btn.style.color === 'var(--gold)';
    updatePinBtn(!isPinned);
  }
}

function updatePinBtn(pinned) {
  const btn = document.getElementById('pinBtn');
  btn.style.borderColor = pinned ? 'var(--gold)' : '';
  btn.style.color = pinned ? 'var(--gold)' : '';
}

function updateWordCount() {
  const body = document.getElementById('noteBody').value;
  const count = body.trim() ? body.trim().split(/\s+/).length : 0;
  document.getElementById('wordCount').textContent = count + ' word' + (count !== 1 ? 's' : '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMMUNICATION WITH SHELL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendToast(msg, cls) {
  if (window.parent !== window) {
    window.parent.postMessage({ type: 'toast', msg, cls }, '*');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEYBOARD SHORTCUTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', e => {
  if (e.code === 'Escape' && document.getElementById('editor').classList.contains('open')) {
    closeEditor();
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadNotes();
renderList();

// Refresh when visible (data may change from other tabs)
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) { loadNotes(); renderList(); }
});
</script>
</body>
</html>
