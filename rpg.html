<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>RPG Hub ‚Äî Chronicle & Forge</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0d0f;--bg2:#13131a;--bg3:#1a1a24;--bg4:#222230;--border:#2e2e42;--border2:#3d3d58;--gold:#c9a84c;--gold2:#e8c97a;--gold3:#8a6a20;--text:#d4d4e8;--text2:#9090aa;--text3:#5a5870;--red:#cc5555;--green:#55aa77;--accent:#7b6cee;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Crimson Pro',Georgia,serif;font-size:16px;padding:0 0 60px;min-height:100vh;}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:.4;}

/* HEADER */
.hub-header{padding:18px 16px 12px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,var(--bg) 0%,var(--bg2) 100%);}
.hub-title{font-family:'Cinzel',serif;font-size:11px;letter-spacing:.2em;color:var(--text3);text-transform:uppercase;margin-bottom:4px;}
.hub-game{font-family:'Cinzel',serif;font-size:20px;color:var(--gold2);letter-spacing:.06em;margin-bottom:2px;}
.hub-tagline{font-size:13px;color:var(--text2);font-style:italic;}
.hub-edit{background:none;border:1px solid var(--border);color:var(--text3);padding:4px 10px;border-radius:3px;font-family:'Cinzel',serif;font-size:8px;letter-spacing:.08em;cursor:pointer;margin-top:8px;}
.hub-edit:active{border-color:var(--gold);color:var(--gold);}

/* STATS ROW */
.stats-row{display:flex;gap:0;border-bottom:1px solid var(--border);}
.stat-chip{flex:1;padding:10px 6px;text-align:center;border-right:1px solid var(--border);}
.stat-chip:last-child{border-right:none;}
.stat-num{font-family:'Cinzel',serif;font-size:18px;color:var(--gold);display:block;}
.stat-label{font-family:'Cinzel',serif;font-size:7px;letter-spacing:.1em;color:var(--text3);text-transform:uppercase;margin-top:2px;display:block;}

/* MODULE GRID */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:14px;}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:7px;padding:14px;cursor:pointer;transition:all .15s;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold3),var(--gold));opacity:0;transition:opacity .2s;}
.card:active::before{opacity:1;}
.card:active{border-color:var(--gold3);background:var(--bg3);}
.card.full{grid-column:1/-1;}
.card-icon{font-size:26px;margin-bottom:8px;display:block;}
.card-name{font-family:'Cinzel',serif;font-size:11px;color:var(--gold);letter-spacing:.06em;margin-bottom:4px;}
.card-desc{font-size:12px;color:var(--text3);line-height:1.4;}
.card-count{position:absolute;top:10px;right:10px;font-family:'Cinzel',serif;font-size:9px;color:var(--text3);background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:2px 7px;}

/* DICE ROLLER */
.dice-row{display:flex;gap:7px;justify-content:center;flex-wrap:wrap;padding:0 14px 4px;}
.die{width:44px;height:44px;background:var(--bg2);border:1px solid var(--border2);border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0;}
.die:active{border-color:var(--gold);background:var(--bg3);transform:scale(.9);}
.die-face{font-size:18px;line-height:1;}
.die-label{font-family:'Cinzel',serif;font-size:7px;color:var(--text3);letter-spacing:.06em;}
.roll-result{text-align:center;padding:8px 14px 14px;}
.roll-num{font-family:'Cinzel',serif;font-size:38px;color:var(--gold2);line-height:1;transition:all .2s;}
.roll-info{font-size:13px;color:var(--text3);margin-top:3px;font-style:italic;}
@keyframes pop{0%{transform:scale(1.5);opacity:.5;}100%{transform:scale(1);opacity:1;}}
.popping{animation:pop .25s cubic-bezier(.22,1.8,.36,1);}

/* SETTINGS MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:200;display:none;align-items:flex-end;justify-content:center;}
.overlay.open{display:flex;}
.modal{background:var(--bg2);border:1px solid var(--border2);border-top:1px solid var(--gold3);border-radius:8px 8px 0 0;width:100%;max-width:540px;max-height:88vh;overflow-y:auto;padding:18px;padding-bottom:calc(18px + env(safe-area-inset-bottom,0));}
.modal h2{font-family:'Cinzel',serif;font-size:14px;color:var(--gold);letter-spacing:.1em;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.field{margin-bottom:12px;}
label{display:block;font-family:'Cinzel',serif;font-size:9px;letter-spacing:.1em;color:var(--text2);text-transform:uppercase;margin-bottom:5px;}
input[type="text"],select{background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:3px;font-family:'Crimson Pro',serif;font-size:15px;width:100%;outline:none;}
input:focus{border-color:var(--gold);}
select option{background:var(--bg3);}
.modal-actions{display:flex;gap:8px;margin-top:14px;justify-content:flex-end;}
.btn{padding:7px 14px;border:1px solid var(--border2);background:var(--bg3);color:var(--text);border-radius:3px;font-family:'Cinzel',serif;font-size:10px;letter-spacing:.06em;cursor:pointer;}
.btn:active{border-color:var(--gold);color:var(--gold);}
.btn-gold{background:linear-gradient(135deg,var(--gold3),var(--gold));border-color:var(--gold2);color:#1a1200;font-weight:600;}
.section-label{font-family:'Cinzel',serif;font-size:9px;letter-spacing:.15em;color:var(--text3);text-transform:uppercase;padding:0 14px;margin:4px 0 10px;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
</style>
</head>
<body>

<!-- HEADER -->
<div class="hub-header">
  <div class="hub-title">Chronicle & Forge ¬∑ RPG Suite</div>
  <div class="hub-game" id="hubGame">My Game</div>
  <div class="hub-tagline" id="hubTagline">Your world awaits</div>
  <button class="hub-edit" onclick="openSettings()">‚öô Game Settings</button>
</div>

<!-- STATS -->
<div class="stats-row">
  <div class="stat-chip"><span class="stat-num" id="statPages">0</span><span class="stat-label">Pages</span></div>
  <div class="stat-chip"><span class="stat-num" id="statChars">0</span><span class="stat-label">Characters</span></div>
  <div class="stat-chip"><span class="stat-num" id="statCreatures">0</span><span class="stat-label">Creatures</span></div>
  <div class="stat-chip"><span class="stat-num" id="statSessions">0</span><span class="stat-label">Sessions</span></div>
</div>

<!-- MODULE CARDS -->
<div class="grid">

  <div class="card" onclick="nav('rpg-rules')">
    <span class="card-icon">üìñ</span>
    <div class="card-name">Rulebook</div>
    <div class="card-desc">Write your rules, mechanics & zine content</div>
    <div class="card-count" id="countRules">0 pg</div>
  </div>

  <div class="card" onclick="nav('rpg-characters')">
    <span class="card-icon">üßô</span>
    <div class="card-name">Characters</div>
    <div class="card-desc">Sheet designer & player characters</div>
    <div class="card-count" id="countChars">0</div>
  </div>

  <div class="card" onclick="nav('rpg-bestiary')">
    <span class="card-icon">üêâ</span>
    <div class="card-name">Bestiary</div>
    <div class="card-desc">Creatures, NPCs, bosses & stat blocks</div>
    <div class="card-count" id="countBest">0</div>
  </div>

  <div class="card" onclick="nav('rpg-campaign')">
    <span class="card-icon">üìú</span>
    <div class="card-name">Campaign</div>
    <div class="card-desc">Sessions, factions, threads & timeline</div>
    <div class="card-count" id="countSess">0</div>
  </div>

  <div class="card full" onclick="nav('rpg-play')" style="display:flex;align-items:center;gap:16px;padding:16px;">
    <span style="font-size:36px;">‚öîÔ∏è</span>
    <div>
      <div class="card-name" style="font-size:13px;margin-bottom:4px;">Play Table</div>
      <div class="card-desc">Dice roller ¬∑ Encounter tracker ¬∑ Session notes</div>
    </div>
    <div style="margin-left:auto;font-family:Cinzel,serif;font-size:20px;color:var(--gold);opacity:.5;">‚Ä∫</div>
  </div>

</div>

<!-- DICE ROLLER -->
<div class="section-label">Quick Roll</div>
<div class="dice-row">
  <div class="die" onclick="roll(4)"><div class="die-face">‚óá</div><div class="die-label">d4</div></div>
  <div class="die" onclick="roll(6)"><div class="die-face">‚¨°</div><div class="die-label">d6</div></div>
  <div class="die" onclick="roll(8)"><div class="die-face">‚óà</div><div class="die-label">d8</div></div>
  <div class="die" onclick="roll(10)"><div class="die-face">‚óâ</div><div class="die-label">d10</div></div>
  <div class="die" onclick="roll(12)"><div class="die-face">‚¨ü</div><div class="die-label">d12</div></div>
  <div class="die" onclick="roll(20)"><div class="die-face">‚ñ≥</div><div class="die-label">d20</div></div>
  <div class="die" onclick="roll2d6()" style="width:52px;"><div class="die-face" style="font-size:13px;font-family:Cinzel,serif;">2d6</div><div class="die-label">2d6</div></div>
</div>
<div class="roll-result">
  <div class="roll-num" id="rollNum">‚Äî</div>
  <div class="roll-info" id="rollInfo">Tap a die to roll</div>
</div>

<!-- SETTINGS MODAL -->
<div class="overlay" id="modal-settings">
  <div class="modal">
    <h2>Game Settings</h2>
    <div class="field"><label>Game Title</label><input type="text" id="inTitle" placeholder="e.g. The Shattered Crown"></div>
    <div class="field"><label>Tagline</label><input type="text" id="inTagline" placeholder="e.g. A kingdom in pieces"></div>
    <div class="field"><label>Dice System</label>
      <select id="inDice">
        <option value="2d6">2d6 (Powered by the Apocalypse style)</option>
        <option value="d20">d20 (D&D style)</option>
        <option value="d6pool">d6 Pool (World of Darkness style)</option>
        <option value="custom">Custom</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal()">Cancel</button>
      <button class="btn btn-gold" onclick="saveSettings()">Save ‚ú¶</button>
    </div>
  </div>
</div>

<script>
function getData(){try{return JSON.parse(localStorage.getItem('chronicle_ttrpg')||'{}');}catch{return{};}}
function saveData(d){localStorage.setItem('chronicle_ttrpg',JSON.stringify(d));}
function nav(module){
  if(window.parent&&window.parent!==window)window.parent.postMessage({type:'navigate',module},'*');
  else window.location.href=module+'.html';
}

function loadStats(){
  const d=getData();
  const meta=d.meta||{};
  document.getElementById('hubGame').textContent=meta.gameTitle||'My Game';
  document.getElementById('hubTagline').textContent=meta.tagline||'Your world awaits';
  const sections=((d.rules||{}).sections)||[];
  const words=sections.reduce((a,s)=>a+(s.wordCount||0),0);
  document.getElementById('statPages').textContent=Math.max(0,Math.round(words/250));
  const chars=(d.characters||[]).length;
  const best=(d.bestiary||[]).length;
  const sess=((d.campaign||{}).sessions||[]).length;
  document.getElementById('statChars').textContent=chars;
  document.getElementById('statCreatures').textContent=best;
  document.getElementById('statSessions').textContent=sess;
  document.getElementById('countRules').textContent=sections.length+' sections';
  document.getElementById('countChars').textContent=chars+' chars';
  document.getElementById('countBest').textContent=best+' entries';
  document.getElementById('countSess').textContent=sess+' sessions';
}

// Dice
function roll(sides){
  const r=Math.floor(Math.random()*sides)+1;
  const el=document.getElementById('rollNum');
  el.textContent=r;el.classList.remove('popping');void el.offsetWidth;el.classList.add('popping');
  const crit=r===sides,fumble=r===1;
  document.getElementById('rollInfo').textContent=crit?`d${sides} ‚Äî Critical! Maximum`:(fumble?`d${sides} ‚Äî Fumble. Minimum`:`d${sides}`);
}
function roll2d6(){
  const a=Math.floor(Math.random()*6)+1,b=Math.floor(Math.random()*6)+1,t=a+b;
  const el=document.getElementById('rollNum');
  el.textContent=t;el.classList.remove('popping');void el.offsetWidth;el.classList.add('popping');
  document.getElementById('rollInfo').textContent=t>=10?'Full success ‚ú¶':t>=7?'Partial success ‚Äî cost or complication':'Miss ‚Äî failure or setback';
}

// Settings modal
function openSettings(){
  const d=getData(),m=d.meta||{};
  document.getElementById('inTitle').value=m.gameTitle||'';
  document.getElementById('inTagline').value=m.tagline||'';
  document.getElementById('inDice').value=m.diceSystem||'2d6';
  document.getElementById('modal-settings').classList.add('open');
}
function saveSettings(){
  const d=getData();if(!d.meta)d.meta={};
  d.meta.gameTitle=document.getElementById('inTitle').value.trim()||'My Game';
  d.meta.tagline=document.getElementById('inTagline').value.trim();
  d.meta.diceSystem=document.getElementById('inDice').value;
  d.meta.lastModified=Date.now();
  saveData(d);closeModal();loadStats();
}
function closeModal(){document.getElementById('modal-settings').classList.remove('open');}
document.getElementById('modal-settings').addEventListener('click',e=>{if(e.target===document.getElementById('modal-settings'))closeModal();});

loadStats();
document.addEventListener('visibilitychange',()=>{if(!document.hidden)loadStats();});
</script>
</body>
</html>
